<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcard Học Từ Vựng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            touch-action: manipulation; /* Ngăn các hành động chạm mặc định như zoom */
        }
        /* Container cho hiệu ứng lật */
        .flip-card {
            background-color: transparent;
            width: 100%;
            height: 100%;
            perspective: 1000px; /* Hiệu ứng 3D */
            cursor: pointer;
        }

        /* Container bên trong, thực hiện việc lật */
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
            border-radius: 1rem; /* bo góc */
        }

        /* Lật thẻ khi có class 'is-flipped' */
        .flip-card.is-flipped .flip-card-inner {
            transform: rotateY(180deg);
        }

        /* Mặt trước và mặt sau */
        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden; /* Safari */
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            border-radius: 1rem; /* bo góc */
        }

        /* Kiểu cho mặt trước */
        .flip-card-front {
            background-color: #ffffff;
            color: black;
        }

        /* Kiểu cho mặt sau */
        .flip-card-back {
            background-color: #4A90E2;
            color: white;
            transform: rotateY(180deg);
        }
        .loader {
            border: 8px solid #f3f3f3;
            border-radius: 50%;
            border-top: 8px solid #3498db;
            width: 60px;
            height: 60px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-4">

    <div id="app-container" class="w-full max-w-lg mx-auto">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-4">Flashcard Học Từ Vựng</h1>
        <p class="text-center text-gray-600 mb-6">Sử dụng phím mũi tên/vuốt để chuyển thẻ, phím cách/chạm để lật.</p>

        <!-- Loading Indicator -->
        <div id="loader-container" class="flex flex-col items-center justify-center h-80">
            <div class="loader"></div>
            <p class="mt-4 text-gray-600">Đang tải dữ liệu phiên âm...</p>
        </div>
        
        <!-- Flashcard Container -->
        <div id="flashcard-container" class="h-80 w-full mb-6 hidden">
            <div id="flashcard" class="flip-card">
                <div class="flip-card-inner">
                    <div class="flip-card-front">
                        <p id="card-front-content" class="text-2xl"></p>
                    </div>
                    <div class="flip-card-back">
                        <h2 id="card-back-word" class="text-4xl font-bold"></h2>
                        <p id="card-back-phonetic" class="text-xl italic text-gray-200 my-2"></p>
                        <p id="card-back-example" class="text-lg mt-4"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress Indicator -->
        <div id="progress-indicator" class="text-center text-lg font-semibold text-gray-700 mb-6 hidden"></div>

        <!-- Controls -->
        <div id="controls" class="flex justify-center space-x-4 hidden">
            <button id="shuffle-button" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-transform transform hover:scale-105">
                Trộn thẻ
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Dữ liệu từ vựng ban đầu
            const initialCardsData = [
                { english: 'although', vietnamese: 'Dù, mặc dù (dùng để giới thiệu một mệnh đề tương phản với mệnh đề chính).', example: 'Although many facts about space had been learned, they weren’t enough to help send humans to space safely.' },
                { english: 'apply', vietnamese: 'Áp dụng, gắn (gắn dây điện vào da Laika).', example: 'Scientists carefully applied wires to Laika’s skin to measure her body’s reactions once she got into space.' },
                { english: 'await', vietnamese: 'Chờ đợi (các nhà khoa học chờ thông tin từ tàu vũ trụ).', example: 'Scientists on Earth awaited information from the ship.' },
                { english: 'beloved', vietnamese: 'Được yêu quý (Laika là một trong những nhà du hành vũ trụ được yêu quý nhất).', example: 'One of the world’s most beloved space travelers was also the furriest.' },
                { english: 'bury', vietnamese: 'Chôn cất (Laika không bao giờ được chôn cất).', example: 'Laika was never buried, but an established memorial has been established in Moscow.' },
                { english: 'climate', vietnamese: 'Khí hậu (khí hậu rất lạnh ở Moscow).', example: 'She found ways to keep warm in a very cold climate.' },
                { english: 'complain', vietnamese: 'Phàn nàn (một số người phàn nàn rằng không nên dùng Laika).', example: 'Some have complained that the little dog should never have been used in the mission.' },
                { english: 'confuse', vietnamese: 'Gây bối rối, làm sợ hãi (chuyến đi làm Laika bối rối và sợ hãi).', example: 'The trip confused and scared her.' },
                { english: 'due', vietnamese: 'Đến hạn, dự kiến (tàu Sputnik 2 dự kiến rời Trái Đất).', example: 'On November 3, 1957 the Sputnik 2 spaceship was due to leave Earth.' },
                { english: 'entire', vietnamese: 'Toàn bộ (toàn bộ con tàu của Laika trở nên nóng như lò nung).', example: 'Laika’s entire ship had become as hot as a furnace.' },
                { english: 'establish', vietnamese: 'Thành lập, xây dựng (một đài tưởng niệm đã được xây dựng ở Moscow).', example: 'an established memorial has been established in Moscow.' },
                { english: 'furnace', vietnamese: 'Lò nung (con tàu nóng như lò nung).', example: 'Laika’s entire ship had become as hot as a furnace.' },
                { english: 'leash', vietnamese: 'Dây xích, dây buộc (Laika đeo một dây buộc đặc biệt).', example: 'Laika also wore a special leash.' },
                { english: 'mature', vietnamese: 'Trưởng thành (Laika trưởng thành trên đường phố).', example: 'She matured on the streets because no one would give her a home.' },
                { english: 'measure', vietnamese: 'Đo (đo phản ứng cơ thể của Laika).', example: 'Scientists carefully applied wires to Laika’s skin to measure her body’s reactions once she got into space.' },
                { english: 'midst', vietnamese: 'Giữa (giữa lúc hào hứng).', example: 'But in the midst of so much excitement, something very sad happened.' },
                { english: 'misery', vietnamese: 'Sự đau khổ (các nhà khoa học bất lực trước sự đau khổ của Laika).', example: 'Scientists were powerless to help the dog in her misery.' },
                { english: 'prior', vietnamese: 'Trước đó (trong một lần phóng trước đó).', example: 'In a prior launch, Russia had put the first man-made object into space.' },
                { english: 'research', vietnamese: 'Nghiên cứu (Laika được chọn để giúp các nhà khoa học với nghiên cứu của họ).', example: 'Laika and two other dogs were chosen to help scientists with their research.' },
                { english: 'variety', vietnamese: 'Sự đa dạng, nhiều loại (các loài động vật được sử dụng trong nhiều loại thử nghiệm).', example: 'The animals were used in a variety of tests.' }
            ];

            let cards = [];
            let currentCardIndex = 0;

            const flashcard = document.getElementById('flashcard');
            const cardFrontContent = document.getElementById('card-front-content');
            const cardBackWord = document.getElementById('card-back-word');
            const cardBackPhonetic = document.getElementById('card-back-phonetic');
            const cardBackExample = document.getElementById('card-back-example');
            const shuffleButton = document.getElementById('shuffle-button');
            const progressIndicator = document.getElementById('progress-indicator');
            const loaderContainer = document.getElementById('loader-container');
            const flashcardContainer = document.getElementById('flashcard-container');
            const controls = document.getElementById('controls');
            
            // Hàm lấy phiên âm từ API
            async function fetchPhonetic(word) {
                try {
                    const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
                    if (!response.ok) {
                        return `[không tìm thấy]`;
                    }
                    const data = await response.json();
                    // Tìm phiên âm trong dữ liệu trả về
                    const phoneticEntry = data[0]?.phonetics?.find(p => p.text);
                    return phoneticEntry?.text || data[0]?.phonetic || `[không tìm thấy]`;
                } catch (error) {
                    console.error('Lỗi khi lấy phiên âm cho từ:', word, error);
                    return `[lỗi mạng]`;
                }
            }

            // Hàm khởi tạo ứng dụng
            async function initializeApp() {
                // Lấy phiên âm cho tất cả các thẻ
                const phoneticPromises = initialCardsData.map(card => fetchPhonetic(card.english));
                const phonetics = await Promise.all(phoneticPromises);

                // Gắn phiên âm vào dữ liệu thẻ
                cards = initialCardsData.map((card, index) => ({
                    ...card,
                    phonetic: phonetics[index]
                }));

                // Ẩn loader và hiện nội dung
                loaderContainer.style.display = 'none';
                flashcardContainer.classList.remove('hidden');
                controls.classList.remove('hidden');
                progressIndicator.classList.remove('hidden');

                // Hiển thị thẻ đầu tiên
                renderCard();
            }

            // Hàm hiển thị nội dung thẻ hiện tại
            function renderCard() {
                if (cards.length === 0) return;
                const card = cards[currentCardIndex];
                cardFrontContent.textContent = card.vietnamese;
                cardBackWord.textContent = card.english;
                cardBackPhonetic.textContent = card.phonetic;
                cardBackExample.textContent = `"${card.example}"`;
                updateProgress();
                // Reset trạng thái lật khi chuyển thẻ
                if (flashcard.classList.contains('is-flipped')) {
                    flashcard.classList.remove('is-flipped');
                }
            }

            // Hàm cập nhật tiến độ
            function updateProgress() {
                progressIndicator.textContent = `Thẻ ${currentCardIndex + 1} / ${cards.length}`;
            }

            // Hàm lật thẻ
            function flipCard() {
                flashcard.classList.toggle('is-flipped');
            }

            // Hàm chuyển thẻ tiếp theo
            function nextCard() {
                currentCardIndex = (currentCardIndex + 1) % cards.length;
                renderCard();
            }

            // Hàm chuyển thẻ trước đó
            function prevCard() {
                currentCardIndex = (currentCardIndex - 1 + cards.length) % cards.length;
                renderCard();
            }

            // Hàm trộn thẻ
            function shuffleCards() {
                // Thuật toán Fisher-Yates
                for (let i = cards.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [cards[i], cards[j]] = [cards[j], cards[i]];
                }
                currentCardIndex = 0;
                renderCard();
                alert('Đã trộn thẻ thành công!');
            }
            
            // Gán sự kiện cho nút trộn
            shuffleButton.addEventListener('click', shuffleCards);

            // Gán sự kiện cho việc lật thẻ khi click/chạm
            flashcard.addEventListener('click', flipCard);

            // Gán sự kiện cho bàn phím
            document.addEventListener('keydown', (e) => {
                switch (e.code) {
                    case 'Space':
                        e.preventDefault(); // Ngăn cuộn trang
                        flipCard();
                        break;
                    case 'ArrowRight':
                    case 'ArrowDown':
                        nextCard();
                        break;
                    case 'ArrowLeft':
                    case 'ArrowUp':
                        prevCard();
                        break;
                }
            });

            // Xử lý vuốt trên di động
            let touchstartX = 0;
            let touchendX = 0;

            flashcard.addEventListener('touchstart', (e) => {
                touchstartX = e.changedTouches[0].screenX;
            }, { passive: true });

            flashcard.addEventListener('touchend', (e) => {
                touchendX = e.changedTouches[0].screenX;
                handleSwipe();
            }, { passive: true });

            function handleSwipe() {
                const swipeThreshold = 50; // Ngưỡng vuốt tối thiểu (pixel)
                if (touchendX < touchstartX - swipeThreshold) {
                    // Vuốt sang trái -> thẻ tiếp theo
                    nextCard();
                } else if (touchendX > touchstartX + swipeThreshold) {
                    // Vuốt sang phải -> thẻ trước đó
                    prevCard();
                }
            }
            
            // Bắt đầu ứng dụng
            initializeApp();
        });
    </script>
</body>
</html>